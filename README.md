# API de Encurtamento de URLs

![NestJS](https://img.shields.io/badge/nestjs-%23E0234E.svg?style=for-the-badge&logo=nestjs&logoColor=white)
![TypeScript](https://img.shields.io/badge/typescript-%23007ACC.svg?style=for-the-badge&logo=typescript&logoColor=white)
![Prisma](https://img.shields.io/badge/Prisma-3982CE?style=for-the-badge&logo=Prisma&logoColor=white)
![PostgreSQL](https://img.shields.io/badge/postgresql-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white)
![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white)
![Jest](https://img.shields.io/badge/-jest-%23C21325?style=for-the-badge&logo=jest&logoColor=white)

---

## üìù Descri√ß√£o Geral

Uma **API RESTful moderna e escal√°vel** feita em **NestJS** para encurtamento de URLs com recursos avan√ßados de gerenciamento e seguran√ßa.

### ‚ú® Principais Funcionalidades

- üîó **Encurtamento de URLs** - Gera√ß√£o autom√°tica de c√≥digos curtos Base62 (6 caracteres)
- üîê **Autentica√ß√£o JWT** - Sistema completo de registro e login com tokens stateless
- üóÑÔ∏è **Persist√™ncia com Prisma ORM** - PostgreSQL como banco de dados relacional
- üé® **Aliases Customizados** - URLs personalizadas com valida√ß√£o de unicidade
- üìä **Contagem de Acessos** - Tracking autom√°tico de cada redirecionamento
- üóëÔ∏è **Soft Delete** - Preserva√ß√£o de dados hist√≥ricos sem remo√ß√£o f√≠sica
- üìö **Documenta√ß√£o Swagger** - API totalmente documentada e test√°vel via interface web
- üê≥ **Docker Compose** - Deploy local simplificado com containers
- üß™ **Cobertura de Testes** - Testes unit√°rios e E2E com +80% de cobertura
- ‚ö° **Redis Cache** - Performance otimizada para URLs mais acessadas
- üõ°Ô∏è **Seguran√ßa** - Helmet, CORS, Rate Limiting e valida√ß√µes robustas

---

## üöÄ Tecnologias Utilizadas

| Tecnologia | Descri√ß√£o | Vers√£o |
|------------|-----------|---------|
| **Node.js** | Runtime JavaScript server-side | LTS (v20+) |
| **NestJS** | Framework progressivo Node.js para aplica√ß√µes server-side escal√°veis | ^11.x |
| **TypeScript** | Superset JavaScript com tipagem est√°tica | ^5.x |
| **Prisma ORM** | ORM moderno para TypeScript e Node.js | ^6.x |
| **PostgreSQL** | Banco de dados relacional open-source | 15+ |
| **JWT** | JSON Web Tokens para autentica√ß√£o stateless | via @nestjs/jwt |
| **Passport** | Middleware de autentica√ß√£o para Node.js | via @nestjs/passport |
| **Redis** | Cache em mem√≥ria para alta performance | Latest |
| **Docker & Docker Compose** | Containeriza√ß√£o e orquestra√ß√£o local | Latest |
| **Jest** | Framework de testes unit√°rios e E2E | ^29.x |
| **Swagger / OpenAPI** | Documenta√ß√£o interativa de APIs | via @nestjs/swagger |
| **ESLint & Prettier** | Linting e formata√ß√£o de c√≥digo | Latest |
| **class-validator** | Valida√ß√£o declarativa baseada em decorators | ^0.14.x |
| **bcrypt** | Hash seguro de senhas | ^6.x |
| **Helmet** | Headers HTTP seguros | ^8.x |

---

## üì¶ Requisitos do Sistema e Regras de Neg√≥cio

### Requisitos Funcionais Principais

#### ‚úÖ 1. Cadastro e Autentica√ß√£o de Usu√°rios
- Registro via e-mail e senha
- Login retorna token JWT com expira√ß√£o configur√°vel
- Senha hasheada com bcrypt (10 salt rounds)
- Valida√ß√£o de e-mail √∫nico no sistema

#### ‚úÖ 2. Encurtamento de URLs
- Funcionalidade dispon√≠vel **com ou sem autentica√ß√£o**
- URLs autenticadas s√£o associadas ao usu√°rio (campo `userId`)
- URLs n√£o autenticadas ficam sem dono (`userId = null`)
- Gera√ß√£o autom√°tica de shortCode Base62 (6 caracteres)
- Suporte a aliases customizados opcionais

#### ‚úÖ 3. Gest√£o de URLs (usu√°rios autenticados)
- Listar todas as URLs pr√≥prias com pagina√ß√£o
- Atualizar URL original ou customAlias
- Excluir URLs (soft delete mant√©m hist√≥rico)
- Visualizar estat√≠sticas de acessos

#### ‚úÖ 4. Redirecionamento
- Endpoint p√∫blico `GET /:short` redireciona para URL original
- Incrementa contador de acessos automaticamente
- Suporte a cache Redis para URLs populares
- Retorna 404 se URL foi deletada ou n√£o existe

#### ‚úÖ 5. Aliases Customizados
- Usu√°rio pode escolher alias personalizado (opcional)
- Deve ser √∫nico globalmente no sistema
- Valida√ß√£o: `^[a-z0-9_-]{3,30}$` (case-insensitive)
- Prote√ß√£o contra colis√£o com rotas reservadas

#### ‚úÖ 6. Soft Delete
- Registros n√£o s√£o removidos fisicamente do banco
- Campo `deletedAt` marca exclus√£o l√≥gica
- URLs deletadas n√£o s√£o acess√≠veis via redirecionamento
- Preserva integridade referencial e hist√≥rico

---

### Regras de Neg√≥cio das URLs

| Regra | Descri√ß√£o |
|-------|-----------|
| **Valida√ß√£o de URL** | Deve conter protocolo `http://` ou `https://` v√°lido |
| **C√≥digo Curto (shortCode)** | Exatamente **6 caracteres** alfanum√©ricos Base62 `[A-Za-z0-9]` case-sensitive |
| **Gera√ß√£o de shortCode** | Algoritmo Base62 a partir de timestamp + hash √∫nico |
| **Colis√£o de shortCode** | Sistema regenera automaticamente at√© encontrar c√≥digo √∫nico |
| **Aliases Customizados** | ‚Ä¢ Min: 3 caracteres<br>‚Ä¢ Max: 30 caracteres<br>‚Ä¢ Apenas lowercase, n√∫meros, `-`, `_`<br>‚Ä¢ Case-insensitive (armazenar lowercase)<br>‚Ä¢ N√£o pode colidir com rotas reservadas (`/auth`, `/docs`, `/api`, `/my-urls`, `/healthcheck`) |
| **Contagem de Acessos** | Campo `accessCount` iniciado em 0 e incrementado a cada `GET /:short` bem-sucedido |
| **Redirecionamento** | HTTP Status **302 Found** (redirect tempor√°rio) |
| **URLs Deletadas** | Retornam **404 Not Found** ao tentar acessar |
| **Timestamps** | `createdAt`, `updatedAt`, `deletedAt` autom√°ticos via Prisma |
| **Dom√≠nio Base** | Configur√°vel via vari√°vel `BASE_URL` (ex: `http://localhost:3000`) |

---

### 4.3. Endpoints da API

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| `POST` | `/auth/register` | Registra novo usu√°rio | ‚ùå |
| `POST` | `/auth/login` | Autentica e retorna JWT | ‚ùå |
| `POST` | `/shorten` | Encurta uma URL | üîì Opcional |
| `GET` | `/my-urls` | Lista URLs do usu√°rio autenticado | ‚úÖ |
| `GET` | `/my-urls/:id` | Lista uma URL do usu√°rio autenticado por id | ‚úÖ |
| `PUT` | `/my-urls/:id` | Atualiza URL (originalUrl ou customAlias) | ‚úÖ |
| `DELETE` | `/my-urls/:id` | Soft delete de URL | ‚úÖ |
| `GET` | `/:short` | Redireciona para URL original | ‚ùå |
| `GET` | `/healthcheck` | Health check da aplica√ß√£o | ‚ùå |

**Legenda:**
- ‚úÖ = Requer token JWT no header `Authorization: Bearer <token>`
- üîì = Opcional (se autenticado, associa `userId`)
- ‚ùå = P√∫blico (sem autentica√ß√£o)

---

## ‚öôÔ∏è Arquitetura da Aplica√ß√£o

A aplica√ß√£o segue os princ√≠pios de **Clean Architecture** e **Domain-Driven Design (DDD)**, garantindo:
- üéØ Separa√ß√£o clara de responsabilidades
- üîÑ Facilidade de manuten√ß√£o e testes
- üìà Escalabilidade horizontal e vertical
- üß© Baixo acoplamento entre m√≥dulos

### Organiza√ß√£o de Camadas

```
graph TD
  src["src/"]
  main[/"main.ts, app.module.ts, app.controller.ts, app.service.ts"/]

  auth["auth/"]
  auth_sub["Controllers, Services, Strategies, Guards, DTOs"]

  user["user/"]
  user_sub["Services, Repositories, Entities"]

  urls["urls/"]
  urls_sub["Repositories, Entities, DTOs"]

  shorten["shorten/"]
  shorten_sub["Controllers, Services, Validators, DTOs"]

  redirect["redirect/"]
  redirect_sub["Service, Controllers"]

  my_urls["my-urls/"]
  my_urls_sub["Controllers, Services"]

  prisma["prisma/"]
  prisma_sub["PrismaModule, PrismaService"]

  common["common/"]
  common_sub["Filters, Middlewares, DTOs"]

  src --> main
  src --> auth --> auth_sub
  src --> user --> user_sub
  src --> urls --> urls_sub
  src --> shorten --> shorten_sub
  src --> redirect --> redirect_sub
  src --> my_urls --> my_urls_sub
  src --> prisma --> prisma_sub
  src --> common --> common_sub

```

### Princ√≠pios Aplicados

- ‚úÖ **Separation of Concerns** - Cada m√≥dulo tem responsabilidade √∫nica bem definida
- ‚úÖ **Dependency Injection** - NestJS IoC Container gerencia todas as depend√™ncias
- ‚úÖ **Repository Pattern** - Abstra√ß√£o completa do acesso a dados
- ‚úÖ **DTO Pattern** - Valida√ß√£o e transforma√ß√£o de dados de entrada/sa√≠da
- ‚úÖ **Strategy Pattern** - Passport JWT Strategy para autentica√ß√£o extens√≠vel
- ‚úÖ **Guard Pattern** - Prote√ß√£o declarativa de rotas autenticadas
- ‚úÖ **Exception Filters** - Tratamento centralizado e padronizado de erros
- ‚úÖ **SOLID Principles** - C√≥digo limpo, test√°vel e manuten√≠vel

---

## üß± Diagrama de Arquitetura

```mermaid
flowchart TD
    subgraph Client["Clientes"]
        A["Cliente HTTP (Postman/cUrl)"]
    end

    subgraph API["API NestJs"]
        B["Auth Module<br/>(JWT, Login/Register)"]
        C["User Module<br/>(User Service)"]
        D["Shorten Module<br/>(Encurtar URLs)"]
        E["Redirect Module<br/>(Redirecionar)"]
        F["My-Urls Module<br/>(CRUD URLs)"]
        G["Prisma Service<br/>(ORM)"]
        R["Redis Cache<br/>(Performance)"]
    end

    subgraph DB["Banco de dados postgres"]
        H[("Tabela: users")]
        I[("Tabela: urls")]
    end

    A -->|HTTP/JSON| B
    A -->|HTTP/JSON| D
    A -->|HTTP/JSON| E
    A -->|HTTP/JSON| F
    
    B -->|Valida credenciais| C
    C -->|CRUD User| G
    D -->|Gera shortCode| G
    E -->|Busca URL| R
    R -->|Cache Miss| G
    F -->|CRUD URLs do user| G
    
    G -->|SQL Queries| H
    G -->|SQL Queries| I
    
    I -.->|Foreign Key| H
```

---

## üîó Diagrama de Fluxo do Encurtamento

```mermaid
flowchart TD
    Start([Cliente faz POST /shorten])
    A[Valida URL original]
    B{URL v√°lida?}
    C[Retorna 400 Bad Request]
    D{Tem customAlias?}
    E[Valida formato do alias]
    F{Alias v√°lido?}
    G{Alias dispon√≠vel?}
    H[Retorna 409 Conflict]
    I{Usu√°rio autenticado?}
    J[Extrai userId do JWT]
    K[Define userId = null]
    L[Gera shortCode Base62<br/>6 caracteres]
    M{shortCode √∫nico?}
    N[Salva URL no banco]
    O[Monta shortUrl completa<br/>BASE_URL + shortCode]
    End([Retorna 201 Created])

    Start --> A
    A --> B
    B -->|N√£o| C
    B -->|Sim| D
    D -->|Sim| E
    E --> F
    F -->|N√£o| C
    F -->|Sim| G
    G -->|N√£o| H
    D -->|N√£o| I
    G -->|Sim| I
    I -->|Sim| J
    I -->|N√£o| K
    J --> L
    K --> L
    L --> M
    M -->|N√£o| L
    M -->|Sim| N
    N --> O
    O --> End
```

---

## üßÆ Modelo Entidade-Relacionamento

```mermaid
erDiagram
    USER {
        UUID id PK
        STRING email UK "√önico, not null"
        STRING password "Hash bcrypt"
        TIMESTAMP createdAt "default: now()"
        TIMESTAMP updatedAt "auto-update"
        TIMESTAMP deletedAt "nullable"
    }

    URL {
        UUID id PK
        TEXT originalUrl "URL completa"
        STRING shortCode UK "6 chars Base62, unique"
        STRING customAlias UK "nullable, 3-30 chars"
        INTEGER accessCount "default: 0"
        TIMESTAMP createdAt "default: now()"
        TIMESTAMP updatedAt "auto-update"
        TIMESTAMP deletedAt "nullable"
        UUID userId FK "nullable"
    }

    USER ||--o{ URL : "possui"
```

**Constraints e √çndices:**
- `email` ‚Üí UNIQUE, NOT NULL, VARCHAR(255)
- `shortCode` ‚Üí UNIQUE, NOT NULL, LENGTH = 6, INDEX
- `customAlias` ‚Üí UNIQUE (quando n√£o nulo), VARCHAR(30), INDEX
- `userId` ‚Üí FK para `users.id`, ON DELETE SET NULL, INDEX

---

## üß∞ Instala√ß√£o e Execu√ß√£o

### 9.1. Pr√©-requisitos

Certifique-se de ter instalado:

- **Node.js** v20+ LTS ([Download](https://nodejs.org/))
- **Docker** e **Docker Compose** ([Download](https://www.docker.com/))
- **pnpm** (recomendado) ou **npm**
- **Git**

```bash
# Instalar pnpm globalmente
npm install -g pnpm
```

---

### 9.2. Passo a Passo

#### **1Ô∏è‚É£ Clone o reposit√≥rio**

```bash
git clone https://github.com/gabrigabs/node-url-shortener.git
cd node-url-shortener
```

#### **2Ô∏è‚É£ Instale as depend√™ncias**

```bash
# Usando pnpm (recomendado)
pnpm install

# Ou usando npm
npm install
```

#### **3Ô∏è‚É£ Configure as vari√°veis de ambiente**

```bash
cp .env.example .env
```

Edite o arquivo `.env` conforme necess√°rio:

```env
# Application
NODE_ENV=development
PORT=3000

# Database
DATABASE_HOST=db
DATABASE_PORT=5432
DATABASE_USER=url_user
DATABASE_PASSWORD=url_pass
DATABASE_NAME=url_shortener
DATABASE_URL="postgresql://url_user:url_pass@db:5432/url_shortener?schema=public"

# JWT
JWT_SECRET=chave-jwt-super-segura-mude-em-producao
JWT_EXPIRES_IN=3600000

# Base URL para URLs encurtadas
BASE_URL=http://localhost:3000

# Redis
REDIS_HOST=redis
REDIS_PORT=6379
```

‚ö†Ô∏è **IMPORTANTE:** Altere `JWT_SECRET` para produ√ß√£o com uma chave forte!

#### **4Ô∏è‚É£ Suba os containers Docker**
##### Para ambiente de desenvolvimento
```bash
docker-compose --profile dev up
```
##### Para ambiente de produ√ß√£o
```bash
docker-compose --profile prod up
```

Isso iniciar√°:
- üêò **PostgreSQL** na porta `5432`
- üî¥ **Redis** na porta `6379`
- üöÄ **Aplica√ß√£o NestJS** na porta `3000`

Verifique se os containers est√£o rodando:

```bash
docker-compose ps
```

#### **5Ô∏è‚É£ Execute as migrations do Prisma**

```bash
# Gerar cliente Prisma
pnpm prisma:generate

# Executar migrations
pnpm prisma:migrate
```

#### **6Ô∏è‚É£ (Opcional) Visualize o banco de dados**

```bash
pnpm prisma:studio
```

Abre interface web em **http://localhost:5555**

#### **7Ô∏è‚É£ Inicie a aplica√ß√£o**

A aplica√ß√£o j√° est√° rodando via Docker, mas voc√™ pode rod√°-la localmente:

```bash
# Desenvolvimento com hot-reload
pnpm start:dev

# Ou em modo produ√ß√£o
pnpm build
pnpm start:prod
```

#### **8Ô∏è‚É£ Acesse a aplica√ß√£o**

- üåê **API:** [http://localhost:3000](http://localhost:3000)
- üìö **Swagger Docs:** [http://localhost:3000/docs](http://localhost:3000/docs)
- üóÑÔ∏è **Prisma Studio:** [http://localhost:5555](http://localhost:5555)
- ‚ù§Ô∏è **Health Check:** [http://localhost:3000/healthcheck](http://localhost:3000/healthcheck)

---

## üö¶ Testes

### 10.1. Testes Unit√°rios

Localizados em `/tests/unit/`, organizados por m√≥dulo com mocks do Prisma:

```bash
# Rodar todos os testes unit√°rios
pnpm test

# Modo watch (desenvolvimento)
pnpm test:watch

# Com cobertura de c√≥digo
pnpm test:cov
```

**Cobertura m√≠nima exigida:** 80% (branches, functions, lines, statements)

### 10.2. Testes E2E (End-to-End)

Localizados em `/tests/e2e/`, testam fluxos completos da aplica√ß√£o:

```bash
# Rodar testes E2E
pnpm test:e2e

# Com cobertura
pnpm test:e2e:cov

# Modo watch
pnpm test:e2e:watch
```

### 10.3. Estrutura de Testes

```
tests/
‚îú‚îÄ‚îÄ unit/                         # Testes unit√°rios isolados
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.spec.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jwt.strategy.spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.service.spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ url/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ url.repository.spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ shorten/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shorten.service.spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ redirect/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redirect.service.spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ my-urls/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ my-urls.service.spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ filters.spec.ts
‚îÇ   ‚îî‚îÄ‚îÄ __mocks__/
‚îÇ       ‚îî‚îÄ‚îÄ prisma.service.mock.ts
‚îÇ
‚îú‚îÄ‚îÄ e2e/                          # Testes end-to-end
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.e2e-spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ url/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ url.e2e-spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ my-urls/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ my-urls.e2e-spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.e2e-spec.ts
‚îÇ   ‚îî‚îÄ‚îÄ setup/
‚îÇ       ‚îî‚îÄ‚îÄ test-helpers.ts
‚îÇ
‚îî‚îÄ‚îÄ jest-setup.ts                 # Configura√ß√£o global do Jest
```

### 10.4. Cobertura de Testes

Os testes cobrem:
- ‚úÖ Autentica√ß√£o (registro, login, valida√ß√£o JWT)
- ‚úÖ Encurtamento de URLs (com e sem autentica√ß√£o)
- ‚úÖ Valida√ß√£o de aliases customizados
- ‚úÖ Redirecionamento e contagem de acessos
- ‚úÖ CRUD de URLs autenticadas
- ‚úÖ Soft delete e queries com deletedAt
- ‚úÖ Tratamento de erros e edge cases

---

## üìò Documenta√ß√£o da API (Swagger)

Ap√≥s iniciar a aplica√ß√£o, acesse a documenta√ß√£o interativa:

üîó **[http://localhost:3000/docs](http://localhost:3000/docs)**

### Recursos da Documenta√ß√£o:

- ‚úÖ **Todos os endpoints** com descri√ß√µes detalhadas
- ‚úÖ **Schemas de request/response** com valida√ß√µes
- ‚úÖ **Exemplos de payloads** prontos para usar
- ‚úÖ **Autentica√ß√£o JWT** via bot√£o "Authorize"
- ‚úÖ **Testagem interativa** direto pelo navegador
- ‚úÖ **C√≥digos de status HTTP** documentados
- ‚úÖ **Modelos de dados** com tipos TypeScript

### Como testar via Swagger:

1. Acesse http://localhost:3000/docs
2. Registre um usu√°rio em `POST /auth/register`
3. Fa√ßa login em `POST /auth/login` e copie o token
4. Clique em "Authorize" e cole o token: `Bearer <seu-token>`
5. Teste os endpoints protegidos!

---

## üåê Vari√°veis de Ambiente

| Vari√°vel | Descri√ß√£o | Valor Padr√£o |
|----------|-----------|--------------|-------------|
| `NODE_ENV` | Ambiente de execu√ß√£o | `development` |
| `PORT` | Porta da aplica√ß√£o | `3000` |
| `DATABASE_HOST` | Host do PostgreSQL | `localhost` |
| `DATABASE_PORT` | Porta do PostgreSQL | `5432` |
| `DATABASE_USER` | Usu√°rio do banco | - |
| `DATABASE_PASSWORD` | Senha do banco | - |
| `DATABASE_NAME` | Nome do banco | - |
| `DATABASE_URL` | String de conex√£o PostgreSQL completa | - | 
| `JWT_SECRET` | Chave secreta para tokens JWT | - |
| `JWT_EXPIRES_IN` | Tempo de expira√ß√£o do token (ms) | `3600000` (1h) | 
| `BASE_URL` | Dom√≠nio base para URLs encurtadas | `http://localhost:3000` |
| `REDIS_HOST` | Host do Redis | `localhost` |
| `REDIS_PORT` | Porta do Redis | `6379` |

### Exemplo completo de `.env`:

```env
NODE_ENV=development
PORT=3000
DATABASE_HOST=db
DATABASE_PORT=5432
DATABASE_USER=url_user
DATABASE_PASSWORD=url_pass
DATABASE_NAME=url_shortener
DATABASE_URL="postgresql://url_user:url_pass@db:5432/url_shortener?schema=public"
JWT_SECRET=chave-jwt-super-segura-mude-em-producao
JWT_EXPIRES_IN=3600000
BASE_URL=http://localhost:3000
REDIS_HOST=redis
REDIS_PORT=6379
```

---

## üß™ Crit√©rios de Qualidade do Projeto

Este projeto segue **rigorosos padr√µes de qualidade de software** para garantir c√≥digo profissional, manuten√≠vel e escal√°vel.

### Qualidade de C√≥digo

- ‚úÖ **TypeScript Strict Mode** ativo para m√°xima seguran√ßa de tipos
- ‚úÖ **ESLint** configurado com regras recomendadas NestJS
- ‚úÖ **Prettier** para formata√ß√£o consistente do c√≥digo
- ‚úÖ **Commits Convencionais** seguindo padr√£o Conventional Commits
- ‚úÖ **Code Review** obrigat√≥rio em PRs
- ‚úÖ **Zero warnings** no build de produ√ß√£o

### Testes

- ‚úÖ **Cobertura ‚â• 80%** em testes unit√°rios
- ‚úÖ **Testes E2E** cobrindo todos os fluxos principais:
  - Autentica√ß√£o (registro e login com valida√ß√µes)
  - Encurtamento de URLs (com e sem autentica√ß√£o)
  - Redirecionamento e contagem de acessos
  - CRUD completo de URLs autenticadas
  - Valida√ß√µes de aliases customizados e colis√µes
  - Soft delete e queries com timestamps
- ‚úÖ **Testes de integra√ß√£o** com banco de dados real
- ‚úÖ **Mocks** do Prisma para testes unit√°rios isolados

### Documenta√ß√£o

- ‚úÖ **Swagger/OpenAPI** completo e atualizado automaticamente
- ‚úÖ **README.md** detalhado com diagramas e exemplos
- ‚úÖ **Coment√°rios JSDoc** em fun√ß√µes complexas
- ‚úÖ **Diagramas Mermaid** para arquitetura e fluxos
- ‚úÖ **Documenta√ß√£o inline** no c√≥digo quando necess√°rio

### DevOps e CI/CD

- ‚úÖ **Docker Compose** para ambiente local reproduz√≠vel
- ‚úÖ **Prisma Migrations** versionadas e testadas
- ‚úÖ **Health Check** endpoint para monitoramento
- ‚úÖ **Logs estruturados** com Winston
- ‚úÖ **Gitub Actions** para valida√ß√£o de workflows

### Seguran√ßa

- ‚úÖ **Senhas hasheadas** com bcrypt (10 salt rounds)
- ‚úÖ **JWT stateless** com expira√ß√£o configur√°vel
- ‚úÖ **Valida√ß√£o de entrada** rigorosa com class-validator
- ‚úÖ **Rate Limiting** com @nestjs/throttler
- ‚úÖ **CORS** configurado adequadamente
- ‚úÖ **Helmet** para headers HTTP seguros
- ‚úÖ **SQL Injection** prevenido via Prisma ORM
- ‚úÖ **XSS Protection** via valida√ß√£o de entrada

### Performance

- ‚úÖ **Redis Cache** para URLs mais acessadas
- ‚úÖ **√çndices de banco** em campos frequentemente consultados
- ‚úÖ **Connection Pooling** do Prisma otimizado
- ‚úÖ **Lazy Loading** de m√≥dulos quando aplic√°vel
- ‚úÖ **Compress√£o** de respostas HTTP

---

## ‚òÅÔ∏è Escalabilidade da Solu√ß√£o

A aplica√ß√£o foi cuidadosamente planejada para garantir alta disponibilidade, desempenho otimizado e capacidade de expans√£o face a varia√ß√µes de carga e crescimento da base de usu√°rios.

### Estrat√©gias de Escalabilidade

#### **Escalabilidade Horizontal**
A aplica√ß√£o segue o princ√≠pio de uma arquitetura stateless, o que possibilita aumentar a capacidade de processamento adicionando m√∫ltiplas inst√¢ncias da API sem a necessidade de compartilhamento de estado entre elas. Dentre as estrategias que podem ser adotadas podemos citar:

**Stateless API com JWT:** Ao utilizar tokens JWT para autentica√ß√£o, eliminamos a necessidade de manter sess√µes ou estados compartilhados no servidor, facilitando a replica√ß√£o horizontal.

**Load Balancer:** Um balanceador de carga (exemplo: NGINX) distribui as requisi√ß√µes entre as inst√¢ncias de forma eficiente para garantir distribui√ß√£o justa e failover autom√°tico.

**Orquestra√ß√£o com Kubernetes:** Possibilita deploy autom√°tico de v√°rias r√©plicas da API, com escalonamento din√¢mico baseado em m√©tricas (Horizontal Pod Autoscaler - HPA).

**Cache Distribu√≠do com Redis:** Implementa√ß√£o de cluster Redis para cache compartilhado entre as inst√¢ncias, reduzindo lat√™ncia e carga no banco.

```mermaid
flowchart LR
    A[Load Balancer<br/>NGINX / ALB] --> B[NestJS<br/>Inst√¢ncia 1]
    A --> C[NestJS<br/>Inst√¢ncia 2]
    A --> D[NestJS<br/>Inst√¢ncia N]
    B --> E[(PostgreSQL<br/>Prim√°rio)]
    C --> E
    D --> E
    B --> F[(Redis<br/>Cluster)]
    C --> F
    D --> F

```

#### **Escalabilidade Vertical**

Al√©m do aumento horizontal, a aplica√ß√£o est√° otimizada para extrair m√°ximo desempenho em uma √∫nica inst√¢ncia podendo ser feitas diversas t√©cnicas, como:

**PostgreSQL Otimizado**: Ajustes finos nos par√¢metros como shared_buffers e work_mem para otimiza√ß√£o de mem√≥ria e I/O.

**Connection Pooling com Prisma:** Limita e gerencia conex√µes simult√¢neas ao banco, evitando sobrecarga e aprimorando efici√™ncia.

**Node.js Cluster Mode:** Uso dos m√∫ltiplos n√∫cleos da CPU, aumentando throughput da aplica√ß√£o em execu√ß√£o mono-inst√¢ncia.

**Otimiza√ß√£o de Mem√≥ria no Redis:** Aplica√ß√£o de pol√≠ticas inteligentes de eviction para manuten√ß√£o do cache eficiente e cont√≠nuo.


#### **Alta Disponibilidade**
Infraestrutura projetada para garantir resili√™ncia e continuidade com m√∫ltiplas zonas geogr√°ficas:


```mermaid
flowchart TD
    A[Usu√°rio] --> B[CDN / CloudFlare<br/>Cache nas bordas]
    B --> C[Load Balancer<br/>Multi-Regi√£o]
    C --> D[App Inst√¢ncia 1<br/>Zona A / us-east-1]
    C --> E[App Inst√¢ncia 2<br/>Zona B / us-west-2]
    D --> F[(PostgreSQL Prim√°rio<br/>Multi-Zone)]
    E --> F
    F --> G[(PostgreSQL R√©plica 1<br/>Somente Leitura)]
    F --> H[(PostgreSQL R√©plica 2<br/>Somente Leitura)]
    D --> I[(Redis Cluster<br/>Sentinel HA)]
    E --> I
    style F fill:#f9f,stroke:#333,stroke-width:2px
    style I fill:#ff9,stroke:#333,stroke-width:2px

```


### Padr√£o de Commits

Este projeto segue **[Conventional Commits](https://www.conventionalcommits.org/)**:

```
feat: adiciona nova funcionalidade
fix: corrige bug espec√≠fico
docs: atualiza documenta√ß√£o
test: adiciona ou corrige testes
refactor: refatora c√≥digo sem mudar comportamento
perf: melhora performance
style: formata√ß√£o, ponto e v√≠rgula, etc
chore: atualiza depend√™ncias ou configura√ß√µes
ci: mudan√ßas em CI/CD
```

### Checklist antes do PR:

- [ ] C√≥digo segue o style guide (ESLint + Prettier)
- [ ] Testes unit√°rios passando (`pnpm test`)
- [ ] Testes E2E passando (`pnpm test:e2e`)
- [ ] Cobertura de testes ‚â• 80%
- [ ] Documenta√ß√£o atualizada (se aplic√°vel)
- [ ] Commit messages seguem Conventional Commits



## üë®‚Äçüíª Autor

**Gabriel Bezerra Rodrigues**  
Desenvolvedor

- üêô **GitHub:** [@gabrigabs](https://github.com/gabrigabs)
- üíº **LinkedIn:** [linkedin.com/in/gabriel-bezerra-rod](https://linkedin.com/in/gabriel-bezerra-rod)


